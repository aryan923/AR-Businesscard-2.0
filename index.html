<!DOCTYPE html>
<html lang="en">
  ...
// Example: Add a cube
console.log('Creating cube');
const geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
const cube = new THREE.Mesh(geometry, material);
scene.add(cube);
console.log('Cube created');

...

function renderFrame(time, frame) {
  console.log('Rendering frame');
  // Rest of the code...
}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Experience</title>
  <style>
    html, body, canvas {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <script src="https://unpkg.com/three@0.134.0/build/three.js"></script>
  <script>
    // Request camera permission and start AR session
    async function startAR() {
      try {
        // Request camera permission
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });

        // Check for WebXR API support
        if ('xr' in navigator) {
          navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
            if (supported) {
              // Initialize AR experience
              document.getElementById('canvas').addEventListener('click', () => {
                // Start AR session
                navigator.xr.requestSession('immersive-ar', { requiredFeatures: ['hit-test'], optionalFeatures: ['dom-overlay'] })
                  .then((session) => {
                    // Create a three.js scene
                    const scene = new THREE.Scene();

                    // Add your AR content to the scene
                    // Example: Add a cube
                    const geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
                    const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
                    const cube = new THREE.Mesh(geometry, material);
                    scene.add(cube);

                    // Create a renderer and attach it to the canvas
                    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas') });
                    renderer.setSize(window.innerWidth, window.innerHeight);

                    // Set up AR session
                    session.addEventListener('end', () => {
                      // Clean up when the session ends
                      renderer.dispose();
                      console.log('AR session ended.');
                    });
                    
                    function renderFrame(time, frame) {
                      const referenceSpace = frame.session.isImmersive ? frame.session.requestReferenceSpace('viewer') : frame.session.requestReferenceSpace('local');
                      const pose = frame.getViewerPose(referenceSpace);
                      if (pose) {
                        // Update AR content position and orientation
                        const xrPose = pose.views[0].transform;
                        const position = new THREE.Vector3();
                        position.setFromMatrixPosition(xrPose);
                        const orientation = new THREE.Quaternion();
                        orientation.setFromRotationMatrix(xrPose);
                        cube.position.copy(position);
                        cube.quaternion.copy(orientation);
                      }
                      renderer.render(scene, pose.views[0].projectionMatrix);
                      frame.session.requestAnimationFrame(renderFrame);
                    }

                    session.updateRenderState({ baseLayer: new XRWebGLLayer(session, renderer) });
                    session.requestAnimationFrame(renderFrame);
                  })
                  .catch((error) => {
                    console.log('Error starting AR session:', error);
                  });
              });
              console.log('Click to start AR experience.');
            } else {
              console.log('AR not supported.');
            }
          }).catch((error) => {
            console.log('Error checking AR support:', error);
          });
        } else {
          console.log('WebXR not supported.');
        }
      } catch (error) {
        console.log('Error accessing camera:', error);
      }
    }

    startAR();
  </script>
</body>
</html>
